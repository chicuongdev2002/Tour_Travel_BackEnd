package vn.edu.iuh.fit.controller;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.http.ResponseEntity;import org.springframework.web.bind.annotation.*;import vn.edu.iuh.fit.dto.DiscountDTO;import vn.edu.iuh.fit.dto.DiscountRequest;import vn.edu.iuh.fit.entity.Discount;import vn.edu.iuh.fit.mailservice.SendDiscountCodeRequest;import vn.edu.iuh.fit.repositories.DiscountRepository;import vn.edu.iuh.fit.service.DiscountService;import java.time.LocalDateTime;import java.util.List;@RestController@RequestMapping("/api/discounts")public class DiscountController {    @Autowired    private DiscountService discountService;    @Autowired    private DiscountRepository discountRepository;    @GetMapping    public List<DiscountDTO> getAllDiscounts() {        return discountService.getAllDiscounts();    }    @PostMapping("/send-discount-code")    public ResponseEntity<String> sendDiscountCode(@RequestBody SendDiscountCodeRequest request) {        try {            return discountService.sendDiscountCodesToEmails(request.getEmails(), request.getDiscountIds());        } catch (RuntimeException e) {            return ResponseEntity.badRequest().body("Đã xảy ra lỗi: " + e.getMessage());        }    }    @GetMapping("/{id}")    public ResponseEntity<DiscountDTO> getDiscountById(@PathVariable Long id) {        return discountService.getDiscountById(id);    }    @PostMapping    public ResponseEntity<DiscountDTO> createDiscount(@RequestBody DiscountRequest request) {        DiscountDTO createdDiscount = discountService.createDiscount(request);        return ResponseEntity.ok(createdDiscount);    }    @PutMapping("/{id}")    public ResponseEntity<DiscountDTO> updateDiscount(@PathVariable Long id, @RequestBody Discount discountDetails) {        return discountService.updateDiscount(id, discountDetails);    }    @DeleteMapping("/{id}")    public ResponseEntity<Void> deleteDiscount(@PathVariable Long id) {        return discountService.deleteDiscount(id);    }    @PutMapping("/useDiscount")    public synchronized ResponseEntity<Discount> useDiscount(@RequestParam String discountCode){        Discount discount = discountRepository.findFirstByDiscountCode(discountCode);        if(discount == null || discount.getCountUse() == 0 || discount.getStartDate().isAfter(LocalDateTime.now()) || discount.getEndDate().isBefore(LocalDateTime.now()))            return ResponseEntity.ok(null);        return ResponseEntity.ok(discount);    }}