package vn.edu.iuh.fit.mailservice;import jakarta.mail.MessagingException;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.beans.factory.annotation.Value;import org.springframework.mail.javamail.JavaMailSender;import org.springframework.mail.javamail.MimeMessageHelper;import org.springframework.stereotype.Service;import java.time.LocalDateTime;import java.time.Year;import java.time.format.DateTimeFormatter;@Servicepublic class EmailService {    @Autowired    private JavaMailSender mailSender;    @Value("${spring.mail.username}")    private String fromEmail;    public void sendVerificationEmail(String toEmail, String code) {        String subject = "X√°c Nh·∫≠n Email";        String content = generateEmailContent(code);        sendHtmlEmail(toEmail, subject, content);    }    private String generateEmailContent(String code) {        return "<!DOCTYPE html>"                + "<html lang='vi'>"                + "<head>"                + "<meta charset='UTF-8'>"                + "<meta name='viewport' content='width=device-width, initial-scale=1.0'>"                + "<style>"                + "body { font-family: 'Roboto', 'Helvetica', Arial, sans-serif; line-height: 1.6; color: #333; background-color: #f4f4f4; margin: 0; padding: 0; }"                + ".container { max-width: 600px; margin: 20px auto; background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); }"                + ".header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #ffffff; padding: 20px; text-align: center; }"                + ".content { padding: 30px; }"                + "h1 { color: #ffffff; margin: 0; font-size: 28px; }"                + "h2 { color: #333333; margin-top: 0; }"                + ".code-container { background-color: #f8f9fa; border: 2px dashed #764ba2; border-radius: 8px; padding: 15px; margin: 25px 0; text-align: center; }"                + ".code { font-size: 36px; font-weight: bold; color: #764ba2; letter-spacing: 5px; }"                + ".footer { background-color: #f8f9fa; text-align: center; padding: 15px; font-size: 12px; color: #666; }"                + ".button { display: inline-block; padding: 12px 24px; background-color: #764ba2; color: #ffffff; text-decoration: none; border-radius: 5px; font-weight: bold; margin-top: 20px; transition: background-color 0.3s; }"                + ".button:hover { background-color: #5a387c; }"                + "@media only screen and (max-width: 600px) { .container { width: 100%; } }"                + "</style>"                + "</head>"                + "<body>"                + "<div class='container'>"                + "<div class='header'>"                + "<h1>X√°c Nh·∫≠n Email</h1>"                + "</div>"                + "<div class='content'>"                + "<p>C·∫£m ∆°n b·∫°n ƒë√£ ƒëƒÉng k√Ω d·ªãch v·ª• c·ªßa ch√∫ng t√¥i. ƒê·ªÉ ho√†n t·∫•t qu√° tr√¨nh ƒëƒÉng k√Ω v√† b·∫£o m·∫≠t t√†i kho·∫£n c·ªßa b·∫°n, vui l√≤ng s·ª≠ d·ª•ng m√£ x√°c nh·∫≠n d∆∞·ªõi ƒë√¢y:</p>"                + "<div class='code-container'>"                + "<div class='code'>" + code + "</div>"                + "</div>"                + "<p>Vui l√≤ng nh·∫≠p m√£ n√†y v√†o trang x√°c nh·∫≠n ƒë·ªÉ k√≠ch ho·∫°t t√†i kho·∫£n c·ªßa b·∫°n. M√£ x√°c nh·∫≠n n√†y s·∫Ω h·∫øt h·∫°n sau 15 ph√∫t.</p>"                + "<p>N·∫øu b·∫°n kh√¥ng y√™u c·∫ßu m√£ n√†y, vui l√≤ng b·ªè qua email n√†y ho·∫∑c li√™n h·ªá v·ªõi b·ªô ph·∫≠n h·ªó tr·ª£ c·ªßa ch√∫ng t√¥i n·∫øu b·∫°n c√≥ b·∫•t k·ª≥ c√¢u h·ªèi n√†o.</p>"                + "<a href='http://localhost:5173/' class='button'>X√°c Nh·∫≠n Email</a>"                + "</div>"                + "<div class='footer'>"                + "<p>ƒê√¢y l√† email t·ª± ƒë·ªông. Vui l√≤ng kh√¥ng tr·∫£ l·ªùi email n√†y.</p>"                + "<p>&copy; 2024 T√™n C√¥ng Ty C·ªßa B·∫°n. T·∫•t c·∫£ c√°c quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>"                + "</div>"                + "</div>"                + "</body>"                + "</html>";    }    public void sendDiscountEmail(String toEmail, String discountCode, String tourName, String imageUrl, String startDate, String endDate) {        String subject = "M√£ Khuy·∫øn M√£i C·ªßa B·∫°n";        String content = generateDiscountEmailContent(discountCode, tourName, imageUrl, startDate,  endDate);        sendHtmlEmail(toEmail, subject, content);    }    private String generateDiscountEmailContent(String discountCode, String tourName, String imageUrl, String startDate, String endDate) {        return "<!DOCTYPE html>"                + "<html lang='vi'>"                + "<head>"                + "<meta charset='UTF-8'>"                + "<meta name='viewport' content='width=device-width, initial-scale=1.0'>"                + "<style>"                + "body { font-family: 'Roboto', 'Arial', sans-serif; line-height: 1.6; color: #333; background-color: #f0f2f5; margin: 0; padding: 20px; }"                + ".container { max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 16px; overflow: hidden; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12); }"                + ".header { background: linear-gradient(135deg, #2ecc71, #27ae60); color: #ffffff; padding: 30px 20px; text-align: center; }"                + ".content { padding: 40px 30px; }"                + "h1 { color: #ffffff; margin: 0; font-size: 32px; font-weight: 700; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }"                + ".code-container { background: linear-gradient(to right bottom, #f8f9fa, #e9ecef); border: 2px dashed #2ecc71; border-radius: 12px; padding: 25px; margin: 30px 0; text-align: center; position: relative; }"                + ".code { font-size: 42px; font-weight: 800; color: #2ecc71; letter-spacing: 8px; text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1); }"                + ".code::before { content: 'üéâ'; font-size: 24px; position: absolute; left: 20px; top: 50%; transform: translateY(-50%); }"                + ".code::after { content: 'üéâ'; font-size: 24px; position: absolute; right: 20px; top: 50%; transform: translateY(-50%); }"                + ".tour-image { width: 100%; height: auto; border-radius: 12px; margin: 25px 0; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); transition: transform 0.3s ease; }"                + ".tour-image:hover { transform: scale(1.02); }"                + ".tour-name { font-size: 24px; font-weight: 600; color: #2c3e50; margin: 20px 0; text-align: center; }"                + ".date-info { background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: center; }"                + ".date-info strong { color: #2ecc71; }"                + ".call-to-action { display: inline-block; background: linear-gradient(135deg, #2ecc71, #27ae60); color: #ffffff; padding: 15px 30px; border-radius: 50px; text-decoration: none; font-weight: bold; margin: 20px 0; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(46, 204, 113, 0.2); }"                + ".call-to-action:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(46, 204, 113, 0.3); }"                + ".footer { background-color: #f8f9fa; text-align: center; padding: 20px; font-size: 13px; color: #666; border-top: 1px solid #eaeaea; }"                + ".notice { font-size: 14px; color: #666; font-style: italic; margin-top: 20px; }"                + "@media (max-width: 600px) {"                + "  .container { margin: 10px; }"                + "  .content { padding: 20px; }"                + "  .code { font-size: 32px; letter-spacing: 6px; }"                + "  .tour-name { font-size: 20px; }"                + "}"                + "</style>"                + "</head>"                + "<body>"                + "<div class='container'>"                + "<div class='header'>"                + "<h1>‚ú® M√£ Khuy·∫øn M√£i ƒê·∫∑c Bi·ªát ‚ú®</h1>"                + "</div>"                + "<div class='content'>"                + "<div class='tour-name'>" + tourName + "</div>"                + "<div class='code-container'>"                + "<div class='code'>" + discountCode + "</div>"                + "</div>"                + "<img src='" + imageUrl + "' alt='Tour Image' class='tour-image'/>"                + "<div class='date-info'>"                + "Th·ªùi gian √°p d·ª•ng: <strong>" + startDate + "</strong> ƒë·∫øn <strong>" + endDate + "</strong>"                + "</div>"                + "<p style='text-align: center;'>S·ª≠ d·ª•ng m√£ n√†y ƒë·ªÉ nh·∫≠n ∆∞u ƒë√£i ƒë·∫∑c bi·ªát cho chuy·∫øn du l·ªãch c·ªßa b·∫°n!</p>"                + "<div style='text-align: center;'>"                + "<a href='#' class='call-to-action'>ƒê·∫∑t Tour Ngay üéØ</a>"                + "</div>"                + "<p class='notice'>* L∆∞u √Ω: N·∫øu b·∫°n kh√¥ng y√™u c·∫ßu m√£ n√†y, vui l√≤ng b·ªè qua email n√†y ho·∫∑c li√™n h·ªá v·ªõi b·ªô ph·∫≠n h·ªó tr·ª£ c·ªßa ch√∫ng t√¥i.</p>"                + "</div>"                + "<div class='footer'>"                + "<p>ƒê√¢y l√† email t·ª± ƒë·ªông, vui l√≤ng kh√¥ng tr·∫£ l·ªùi.</p>"                + "<p>&copy; " + java.time.Year.now().getValue() + " Travel Company. T·∫•t c·∫£ c√°c quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>"                + "</div>"                + "</div>"                + "</body>"                + "</html>";    }    public void sendLockUnlockNotification(String toEmail, String action) {        String subject = "Th√¥ng B√°o V·ªÅ T√†i Kho·∫£n C·ªßa B·∫°n";        String content = generateLockUnlockEmailContent(action,LocalDateTime.now());        sendHtmlEmail(toEmail, subject, content);    }    private String generateLockUnlockEmailContent(String action, LocalDateTime actionTime) {        String actionMessage = "ƒë√£ ƒë∆∞·ª£c m·ªü kh√≥a";        String actionIcon = "üîì";        String bgColor = "#4CAF50";        if ("locked".equals(action)) {            actionMessage = "ƒë√£ b·ªã kh√≥a";            actionIcon = "üîí";            bgColor = "#f44336";        }        String actionTimeStr = actionTime.format(DateTimeFormatter.ofPattern("HH:mm:ss, dd/MM/yyyy"));        return String.join("\n",                "<!DOCTYPE html>",                "<html>",                "<head>",                "<meta charset='utf-8'>",                "<meta name='viewport' content='width=device-width, initial-scale=1.0'>",                "<style>",                "    body {",                "        font-family: 'Segoe UI', Arial, sans-serif;",                "        line-height: 1.6;",                "        color: #333;",                "        margin: 0;",                "        padding: 0;",                "        background-color: #f5f5f5;",                "    }",                "    .container {",                "        max-width: 600px;",                "        margin: 20px auto;",                "        background: #ffffff;",                "        border-radius: 8px;",                "        box-shadow: 0 2px 4px rgba(0,0,0,0.1);",                "        overflow: hidden;",                "    }",                "    .header {",                "        background-color: " + bgColor + ";",                "        color: white;",                "        padding: 30px 20px;",                "        text-align: center;",                "    }",                "    .header-icon {",                "        font-size: 48px;",                "        margin-bottom: 10px;",                "    }",                "    .title {",                "        font-size: 24px;",                "        font-weight: bold;",                "        margin: 0;",                "    }",                "    .content {",                "        padding: 30px;",                "        background: #ffffff;",                "    }",                "    .message-box {",                "        background-color: #f8f9fa;",                "        border-left: 4px solid " + bgColor + ";",                "        padding: 15px;",                "        margin: 20px 0;",                "        border-radius: 4px;",                "    }",                "    .timestamp {",                "        color: #666;",                "        font-size: 14px;",                "        margin: 10px 0;",                "        padding: 10px;",                "        background: #f8f9fa;",                "        border-radius: 4px;",                "        text-align: center;",                "    }",                "    .warning {",                "        background-color: #fff3cd;",                "        border: 1px solid #ffeeba;",                "        color: #856404;",                "        padding: 15px;",                "        margin: 20px 0;",                "        border-radius: 4px;",                "    }",                "    .signature {",                "        margin-top: 30px;",                "        padding-top: 20px;",                "        border-top: 1px solid #eee;",                "    }",                "    .footer {",                "        background: #f8f9fa;",                "        padding: 20px;",                "        text-align: center;",                "        font-size: 12px;",                "        color: #666;",                "    }",                "    .button {",                "        display: inline-block;",                "        padding: 10px 20px;",                "        background-color: " + bgColor + ";",                "        color: white;",                "        text-decoration: none;",                "        border-radius: 4px;",                "        margin: 20px 0;",                "    }",                "    @media only screen and (max-width: 600px) {",                "        .container { margin: 0; border-radius: 0; }",                "        .content { padding: 20px; }",                "    }",                "</style>",                "</head>",                "<body>",                "    <div class='container'>",                "        <div class='header'>",                "            <div class='header-icon'>" + actionIcon + "</div>",                "            <h1 class='title'>Th√¥ng B√°o B·∫£o M·∫≠t</h1>",                "        </div>",                "        <div class='content'>",                "            <p>K√≠nh g·ª≠i qu√Ω kh√°ch,</p>",                "            <div class='message-box'>",                "                <strong>Tr·∫°ng th√°i t√†i kho·∫£n:</strong> T√†i kho·∫£n c·ªßa b·∫°n " + actionMessage + " th√†nh c√¥ng.",                "            </div>",                "            <div class='timestamp'>",                "                <span>‚è∞ Th·ªùi gian th·ª±c hi·ªán: " + actionTimeStr + "</span>",                "            </div>",                "            <div class='warning'>",                "                <strong>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</strong><br>",                "                N·∫øu b·∫°n kh√¥ng th·ª±c hi·ªán thay ƒë·ªïi n√†y, vui l√≤ng li√™n h·ªá ngay v·ªõi b·ªô ph·∫≠n h·ªó tr·ª£ c·ªßa ch√∫ng t√¥i",                "                ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£ k·ªãp th·ªùi.",                "            </div>",                "            <a href='#' class='button'>Li√™n H·ªá H·ªó Tr·ª£</a>",                "            <div class='signature'>",                "                <p>Tr√¢n tr·ªçng,<br>",                "                <strong>ƒê·ªôi ng≈© H·ªó tr·ª£ Kh√°ch h√†ng</strong></p>",                "            </div>",                "        </div>",                "        <div class='footer'>",                "            <p>ƒê√¢y l√† email t·ª± ƒë·ªông. Vui l√≤ng kh√¥ng tr·∫£ l·ªùi email n√†y.</p>",                "            <p>¬© " + Year.now().getValue() + " T√™n C√¥ng Ty C·ªßa B·∫°n. T·∫•t c·∫£ c√°c quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>",                "        </div>",                "    </div>",                "</body>",                "</html>"        );    }    public void sendResetPasswordNotification(String toEmail, String newPassword) {        String subject = "Th√¥ng B√°o Reset M·∫≠t Kh·∫©u";        String content = generateResetPasswordEmailContent(newPassword);        sendHtmlEmail(toEmail, subject, content);    }    private String generateResetPasswordEmailContent(String newPassword) {        return "<!DOCTYPE html>"                + "<html lang='vi'>"                + "<head>"                + "<meta charset='UTF-8'>"                + "<meta name='viewport' content='width=device-width, initial-scale=1.0'>"                + "<style>"                + "body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f2f2f7; color: #333; }"                + ".container { max-width: 600px; margin: 40px auto; background: #ffffff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }"                + ".header { text-align: center; padding-bottom: 20px; border-bottom: 1px solid #e0e0e0; }"                + ".header h1 { font-size: 24px; color: #1a73e8; margin: 0; }"                + ".header img { width: 100px; margin-bottom: 10px; }"                + ".content { margin: 30px 0; line-height: 1.6; }"                + ".content p { margin: 0 0 16px; }"                + ".content strong { color: #d32f2f; font-weight: bold; }"                + ".footer { text-align: center; font-size: 12px; color: #666; padding-top: 20px; border-top: 1px solid #e0e0e0; }"                + ".btn { display: inline-block; padding: 10px 20px; margin-top: 20px; color: #ffffff; background-color: #1a73e8; text-decoration: none; border-radius: 4px; font-size: 14px; }"                + "a { color: #1a73e8; text-decoration: none; }"                + "</style>"                + "</head>"                + "<body>"                + "<div class='container'>"                + "<div class='header'>"                + "<h1>Th√¥ng B√°o Reset M·∫≠t Kh·∫©u</h1>"                + "</div>"                + "<div class='content'>"                + "<p>Ch√†o b·∫°n,</p>"                + "<p>M·∫≠t kh·∫©u m·ªõi c·ªßa b·∫°n l√†: <strong style='font-size: 18px;'>" + newPassword + "</strong></p>"                + "<p>Vui l√≤ng <a href='http://localhost:5173/login-register' class='btn'>ƒëƒÉng nh·∫≠p</a> v√† thay ƒë·ªïi m·∫≠t kh·∫©u c·ªßa b·∫°n ngay l·∫≠p t·ª©c ƒë·ªÉ b·∫£o m·∫≠t t√†i kho·∫£n.</p>"                + "<p>N·∫øu b·∫°n kh√¥ng y√™u c·∫ßu reset m·∫≠t kh·∫©u, vui l√≤ng b·ªè qua email n√†y.</p>"                + "</div>"                + "<div class='footer'>"                + "<p>C·∫£m ∆°n b·∫°n ƒë√£ s·ª≠ d·ª•ng d·ªãch v·ª• c·ªßa ch√∫ng t√¥i!</p>"                + "<p><small>N·∫øu b·∫°n g·∫∑p v·∫•n ƒë·ªÅ, vui l√≤ng li√™n h·ªá v·ªõi ch√∫ng t√¥i qua email h·ªó tr·ª£.</small></p>"                + "</div>"                + "</div>"                + "</body>"                + "</html>";    }    private void sendHtmlEmail(String toEmail, String subject, String content) {        var message = mailSender.createMimeMessage();        try {            MimeMessageHelper helper = new MimeMessageHelper(message, true, "UTF-8");            helper.setFrom(fromEmail);            helper.setTo(toEmail);            helper.setSubject(subject);            helper.setText(content, true);            mailSender.send(message);        } catch (MessagingException e) {            throw new RuntimeException("Kh√¥ng th·ªÉ g·ª≠i email", e);        }    }}