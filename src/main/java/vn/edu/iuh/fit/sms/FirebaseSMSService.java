package vn.edu.iuh.fit.sms;import com.google.auth.oauth2.GoogleCredentials;import com.google.firebase.FirebaseApp;import com.google.firebase.FirebaseOptions;import com.google.firebase.messaging.FirebaseMessaging;import com.google.firebase.messaging.FirebaseMessagingException;import com.google.firebase.messaging.Message;import com.google.firebase.messaging.Notification;import jakarta.annotation.PostConstruct;import org.springframework.core.io.ClassPathResource;import org.springframework.stereotype.Service;import java.io.IOException;import java.io.InputStream;@Servicepublic class FirebaseSMSService {    @PostConstruct    private void initialize() {        try {            ClassPathResource resource = new ClassPathResource("firebase-credentials.json");            InputStream serviceAccount = resource.getInputStream();            FirebaseOptions options = FirebaseOptions.builder()                    .setCredentials(GoogleCredentials.fromStream(serviceAccount))                    .build();            if (FirebaseApp.getApps().isEmpty()) {                FirebaseApp.initializeApp(options);            }        } catch (IOException e) {            throw new RuntimeException("Error initializing Firebase", e);        }    }    public void sendPasswordViaSMS(String phoneNumber, String password) {        try {            System.out.println("Phone number: " + phoneNumber);            String formattedPhone = formatPhoneNumber(phoneNumber);            System.out.println("Formatted phone number: " + formattedPhone);            String message = String.format("Mật khẩu mới của bạn là: %s", password);            System.out.println("Message: " + message);            Message smsMessage = Message.builder()                    .putData("message", message)                    .setToken(formattedPhone)                    .setNotification(Notification.builder()                            .setTitle("Reset Password")                            .setBody(message)                            .build())                    .build();            String response = FirebaseMessaging.getInstance().send(smsMessage);            System.out.println("Successfully sent message: " + response);        } catch (FirebaseMessagingException e) {            throw new RuntimeException("Error sending SMS: " + e.getMessage());        }    }    private String formatPhoneNumber(String phoneNumber) {        String cleaned = phoneNumber.replaceAll("[^0-9+]", "");        if (!cleaned.startsWith("+84") && !cleaned.startsWith("84")) {            if (cleaned.startsWith("0")) {                cleaned = "+84" + cleaned.substring(1);            } else {                cleaned = "+84" + cleaned;            }        }        return cleaned;    }}